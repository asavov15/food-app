{% extends "layout.html" %}

{% block content %}

<!-- Spot header card -->
<div class="card">
  <div class="card-header">
    <div>
      <h2 class="card-title">{{ spot["name"] }}</h2>
      <p class="card-subtitle">{{ spot["category"] }}</p>

      <div class="tags" style="margin-top:6px;">
        {% if spot.late_night %}<span class="tag">Late Night</span>{% endif %}
        {% if spot.fine_dining %}<span class="tag">Fine Dining</span>{% endif %}
        {% if spot.health_conscious %}<span class="tag">Health Conscious</span>{% endif %}
        {% if spot.affordable %}<span class="tag">Affordable</span>{% endif %}
        {% if spot.sweet_treat %}<span class="tag">Sweet Treat</span>{% endif %}
        {% if spot.close %}<span class="tag">Close to Harvard Yard</span>{% endif %}
      </div>
    </div>

    <div class="spot-summary-rating">
      {% if avg_rating %}
        <div class="rating-badge">
          <span class="rating-value">{{ avg_rating }}</span>
          <span class="rating-star">★</span>
        </div>
        <div class="spot-meta">
          {{ review_count }} review{% if review_count != 1 %}s{% endif %}
        </div>
      {% else %}
        <div class="spot-meta">No ratings yet</div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Reviews card -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">Reviews</h3>
  </div>

  {% if reviews %}
    <ul class="review-list">
      {% for review in reviews %}
        <li class="review-item">
          <div class="review-header">
            <span class="rating-pill">{{ review["rating"] }}★</span>
            {% if review["username"] %}
              <span class="review-user">{{ review["username"] }}</span>
            {% endif %}
          </div>
          <p class="review-text">{{ review["text"] }}</p>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">No reviews yet. Be the first to write one.</p>
  {% endif %}
</div>

<!-- Add review -->
{% if session.get("user_id") %}
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Add a review</h3>
    </div>

    <form action="/spot/{{ spot['id'] }}/review" method="POST">
      <label>Rating (1 to 5):</label>
      <input type="number" name="rating" min="1" max="5" required>

      <label class="mt-2">Your review:</label>
      <textarea name="text" required></textarea>

      <div class="mt-3">
        <button type="submit" class="btn btn-primary">Submit review</button>
      </div>
    </form>
  </div>
{% else %}
  <div class="card">
    <p><a href="/login" class="btn btn-primary">Log in to add a review</a></p>
  </div>
{% endif %}

<!-- Manage spot (admin only) -->
{% if session.get("is_admin") %}
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Manage spot</h3>
    </div>
    <div class="manage-buttons">
      <a href="/spot/{{ spot['id'] }}/edit" class="btn btn-outline">Edit this spot</a>
      <form action="/spot/{{ spot['id'] }}/delete"
            method="POST"
            onsubmit="return confirm('Are you sure you want to delete this spot?');">
        <button type="submit" class="btn btn-danger">Delete this spot</button>
      </form>
    </div>
  </div>
{% endif %}

<!-- Favorites -->
{% if session.get("user_id") %}
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Favorites</h3>
    </div>

    {% if is_favorite %}
      <form action="/spot/{{ spot['id'] }}/unfavorite" method="POST">
        <button type="submit" class="btn btn-outline">Remove from favorites</button>
      </form>
    {% else %}
      <form action="/spot/{{ spot['id'] }}/favorite" method="POST">
        <button type="submit" class="btn btn-primary">Add to favorites</button>
      </form>
    {% endif %}
  </div>
{% else %}
  <div class="card">
    <p><a href="/login" class="btn btn-outline">Log in to add this spot to your favorites</a></p>
  </div>
{% endif %}

<p class="mt-3">
  <a href="/spots" class="btn btn-outline">Back to all spots</a>
</p>

{% endblock %}
